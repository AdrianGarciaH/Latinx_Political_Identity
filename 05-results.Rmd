# Results



# Data sources


```{r}
library(haven)
library(tidyverse)
library(viridis)
library(patchwork)
<<<<<<< HEAD
library(vcd)
library(ggalluvial)
=======
library(hrbrthemes)
library(circlize)
library(networkD3)
library(leaflet)
dataset = read_sav("ATP W58.sav")
>>>>>>> edb01a4cc19d5904694c966210c85bad1fc03597
```




```{r}


dataset2 <-  dataset[ , c(1,8,10,11,12,13,14,15,16,17,18,19,21,22,23,32,39,40,41,42,43,44,49,50,51,52,63,64,65,66,67,69,70,71,72,73,74,75,78,79,80,81,82,83,84,85,86,87,88,89,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,110)]

library(tidyverse)
library(dplyr)

ds= as_factor(dataset2)
dataset3 = ds[ , c("F_PARTY_FINAL","YEARSINUS_W58")]

<<<<<<< HEAD
ds %>%
  filter(F_AGECAT != 'Refused')%>%
  ggplot(aes(F_AGECAT)) + 
  geom_bar(color = "grey50", fill = "lightblue", width = 1) + theme_grey(16)
=======
financial_set = dataset2[ , c("F_PARTY_FINAL","HISPORIGCMB_W58","PERSFIN_W58","LAN1_W58","LAN3_W58","IDENSAL_a_W58","IDENSAL_b_W58","IDENSAL_d_W58","IDENSAL_e_W58","IDENSAL_f_W58")]
>>>>>>> edb01a4cc19d5904694c966210c85bad1fc03597

financial_set <- financial_set %>% filter(LAN1_W58+LAN3_W58 <=6)
financial_set <- financial_set %>% filter(IDENSAL_b_W58 <90)

#cor(financial_set)



<<<<<<< HEAD
```
```{r}
#Graph of discrimination versus party preference 
table_ds1 <- ds %>%
  group_by(HISPDISCR_f_W58, F_PARTY_FINAL) %>%
  filter(HISPDISCR_f_W58 != 'Refused',F_PARTY_FINAL != 'Refused', F_PARTY_FINAL != 'Something else') %>%
  ungroup()
  
mosaic(F_PARTY_FINAL ~ HISPDISCR_f_W58,
       data = table_ds1,
       direction = c("v", "h"),
       highlighting_fill = RColorBrewer::brewer.pal(3, "Blues"),
       spacing = spacing_equal(sp = unit(0, "lines")),
       labeling = labeling_border(rot_labels = c(0, 0, 0, 0),
                                  set_varnames = c(HISPDISCR_f_W58 = "Have you expereinced discrimination?", F_PARTY_FINAL = "Party\nPreference"))) +
  theme_grey(16)

```




```{r}
#Graph of people who have heard term Latinx

ds %>%
  filter(LATINX1_W58 != 'Refused') %>%
  ggplot(aes(LATINX1_W58)) + 
  geom_bar(color = "grey50", fill = "lightblue", width = 1) + 
  ylab("Count") + 
  xlab("Response") +
  ggtitle("Have you heard of the term 'Latinx'?") +
  theme_grey(16)
=======

# financial_set$F_PARTY_FINAL <- as_factor(financial_set$F_PARTY_FINAL)
# financial_set$YEARSINUS_W58 <- as_factor(financial_set$YEARSINUS_W58)
# financial_set$HISPORIGCMB_W58 <- as_factor(financial_set$HISPORIGCMB_W58)



>>>>>>> edb01a4cc19d5904694c966210c85bad1fc03597


<<<<<<< HEAD
```{r}
#Of those who have heard of the term Latinx:

#discriminated against vs. Latinx usage
table_ds4 <- ds %>%
  filter(LATINX1_W58 == 'Yes', HISPDISCR_f_W58 != 'Refused', LATINX3_W58 != 'Refused') %>%
  group_by(LATINX3_W58, HISPDISCR_f_W58)%>%
  summarize(n = n()) %>%
  mutate(prop = n/sum(n))
  
ggplot(table_ds4, aes(x=LATINX3_W58, y= prop, fill = HISPDISCR_f_W58)) +geom_col() +
  theme_grey(16)
  

#discriminated against vs belief that Latinx should be used to describe the latino population

table_ds5 <- ds %>%
  filter(LATINX1_W58 == 'Yes', HISPDISCR_f_W58 != 'Refused', LATINX4_W58 != 'Refused') %>%
  group_by(LATINX4_W58, HISPDISCR_f_W58)%>%
  summarize(n = n()) %>%
  mutate(prop = n/sum(n))

ggplot(table_ds5, aes(x=LATINX4_W58, y= prop, fill = HISPDISCR_f_W58)) +geom_col() +
  theme_grey(16)

```


```{r}
ds1 = select(ds, c('HISPDISCR_f_W58', 'KNOWDPORT_W58', 'RACESURV26_W58', 'F_PARTY_FINAL')) 

table_ds2 <- ds1 %>%
  filter(HISPDISCR_f_W58 != 'Refused', KNOWDPORT_W58 != 'Refused', RACESURV26_W58 != 'Refused',F_PARTY_FINAL != 'Refused', F_PARTY_FINAL != 'Something else') %>%
  group_by(HISPDISCR_f_W58, KNOWDPORT_W58, RACESURV26_W58, F_PARTY_FINAL) %>%
  summarize(Freq = n())

ggplot(table_ds2,
       aes(y = Freq, axis1 = HISPDISCR_f_W58, axis2 = KNOWDPORT_W58, axis3 = RACESURV26_W58, axis4 = F_PARTY_FINAL)) +
  geom_alluvium(aes(fill = F_PARTY_FINAL), width = 1/12) +
  geom_stratum(width = 1/12, fill = "black", color = "grey") +
  geom_label(stat = "stratum", aes(label = after_stat(stratum))) +
  scale_x_discrete(limits = c("Discriminated against", "Deportation", "Identifies with other Latinos", "Political Preference"), expand = c(.05, .05)) +
  scale_fill_brewer(type = "qual", palette = "Set1") +
  ggtitle("Political Preference vs. Latino Experience") +
  theme_grey(16)
```


```{r}
#Question 3

table_ds6 <- ds %>%
  filter(LAN1_W58 != 'Refused', F_PARTY_FINAL != 'Refused', F_PARTY_FINAL != 'Something else') %>%
  group_by(LAN1_W58, F_PARTY_FINAL)%>%
  summarize(n = n()) %>%
  mutate(prop = n/sum(n))

ggplot(table_ds6, aes(x=LAN1_W58, y= prop, fill = F_PARTY_FINAL)) +geom_col(position ='dodge') +
  theme_grey(16)

table_ds7 <- ds %>%
  filter(LAN3_W58 != 'Refused', F_PARTY_FINAL != 'Refused', F_PARTY_FINAL != 'Something else') %>%
  group_by(LAN3_W58, F_PARTY_FINAL)%>%
  summarize(n = n()) %>%
  mutate(prop = n/sum(n))

ggplot(table_ds7, aes(x=LAN3_W58, y= prop, fill = F_PARTY_FINAL)) +geom_col(position ='dodge') +
  theme_grey(16)
```
=======
>>>>>>> edb01a4cc19d5904694c966210c85bad1fc03597

# PUERTO RICO counted here as outside US

dataset3  <- dataset3 %>%
     mutate(YEARSINUS_W58 = ifelse(is.na(YEARSINUS_W58),"Not Born in US","Born in US"))

# ggplot(dataset3, aes(x=F_PARTY_FINAL)) +
#   geom_histogram(stat = "count", position = "dodge", freq = TRUE)


# ggplot(dataset3, aes(x=YEARSINUS_W58, fill=F_PARTY_FINAL)) +
#   geom_histogram(stat = "count", position = "dodge", freq = TRUE)

grouped_data <- aggregate(dataset3, by=list(dataset3$F_PARTY_FINAL, dataset3$YEARSINUS_W58), FUN=length)
# can add column with colors and scale_fill_identity()
# build democrat and republican profiles based on views and combine

grouped_data <- subset(grouped_data, select = -F_PARTY_FINAL)
grouped_data <- grouped_data %>% pivot_wider(names_from = "Group.2", values_from = YEARSINUS_W58)

grouped_data$`Not Born in US` <- grouped_data$`Not Born in US`/sum(grouped_data$`Not Born in US`)
grouped_data$`Born in US` <- grouped_data$`Born in US`/sum(grouped_data$`Born in US`)

grouped_data <- grouped_data %>% pivot_longer(!Group.1, names_to = "Birthplace", values_to = "Percent")

grouped_data <- arrange(grouped_data, -Percent)


dataset3$F_PARTY_FINAL <- factor(dataset3$F_PARTY_FINAL, levels = c("Democrat", "Republican", "Independent", "Something else", NA))




# ggplot(data=dataset3, aes(x=F_PARTY_FINAL, y=..count.., fill = factor(..x..))) +
#   geom_bar(stat="count") + scale_fill_manual(values=c("#0015BC", "#FF0000", "Purple","Brown","Yellow"))+
#     labs(y = "Percent", x = "Party", fill="Party")




dataset3 %>% 
  count(F_PARTY_FINAL) %>% 
  mutate(perc = n / nrow(dataset3)) -> temp

ggplot(temp, aes(x = F_PARTY_FINAL, y = perc, fill = factor(..x..))) + geom_bar(stat = "identity") + scale_y_continuous(labels=scales::percent) +
    labs(y = "Percent", x = "Party", fill="Party")  +
    geom_text(aes(label = sprintf("%1.2f%%", 100*perc), vjust = -0.2))+ scale_fill_manual(values=c("#0015BC", "#FF0000", "Grey","Grey","Grey"))



ggplot(dataset3, aes(F_PARTY_FINAL, group = YEARSINUS_W58)) + geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", x = "Party", fill="Party") +
    facet_grid(~YEARSINUS_W58) +
    scale_y_continuous(labels = scales::percent)+ scale_fill_manual(values=c("#0015BC", "#FF0000", "Grey","Grey","Grey"))







dataset4 = ds[ , c("F_PARTY_FINAL","YEARSINUS_W58","HISPORIGCMB_W58")]

dataset4  <- dataset4 %>%
     mutate(YEARSINUS_W58 = ifelse(is.na(YEARSINUS_W58),"Not Born in US","Born in US"))






dataset5 = ds[ , c("F_PARTY_FINAL","HISPORIGCMB_W58")]
data_long <- aggregate(dataset5, by=list(dataset5$F_PARTY_FINAL, dataset5$HISPORIGCMB_W58), FUN=length)

names(data_long)[1] <- 'target'
names(data_long)[2] <- 'source'
names(data_long)[3] <- 'value'

nodes <- data.frame(name=c(as.character(data_long$source), as.character(data_long$target)) %>% unique())

data_long$IDsource=match(data_long$source, nodes$name)-1 
data_long$IDtarget=match(data_long$target, nodes$name)-1


ColourScal ='d3.scaleOrdinal() .range(["#1d8a0f","#1d8a0f","#1d8a0f","#1d8a0f","#1d8a0f","#1d8a0f","#1d8a0f","Black","#FF0000","#0015BC"])'

sankeyNetwork(Links = data_long, Nodes = nodes,
                     Source = "IDsource", Target = "IDtarget",
                     Value = "value", NodeID = "name", 
                     sinksRight=TRUE, colourScale=ColourScal, nodeWidth=40, fontSize=13, nodePadding=20)


# 
# fin_set <- financial_set %>% filter(!(is.na(YEARSINUS_W58)))
# hist(as.numeric(fin_set$YEARSINUS_W58))


```
